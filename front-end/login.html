<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>ÄÄƒng nháº­p</title>
    <link rel="stylesheet" href="login.css" />
  </head>
  <body>
    <div class="container">
      <h2>ÄÄƒng nháº­p</h2>
      <p class="subtitle">Há»‡ thá»‘ng quáº£n lÃ½ khÃ³a há»c trá»±c tuyáº¿n</p>

      <div id="alert" class="alert" style="display: none">
        Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ tÃªn Ä‘Äƒng nháº­p vÃ  máº­t kháº©u.
      </div>

      <input type="text" id="username" placeholder="TÃªn Ä‘Äƒng nháº­p" />
      <input type="password" id="password" placeholder="Máº­t kháº©u" />

      <button onclick="login()">ÄÄƒng nháº­p</button>

      <p>
        ChÆ°a cÃ³ tÃ i khoáº£n?
        <button
          class="secondary"
          onclick="window.location.href='register.html'"
        >
          ÄÄƒng kÃ½
        </button>
      </p>
    </div>

    <script>
      async function login() {
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();

        if (!username || !password) {
          alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ tÃªn Ä‘Äƒng nháº­p vÃ  máº­t kháº©u.");
          return;
        }

        try {
          const res = await fetch("http://localhost:3000/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password }),
          });

          if (!res.ok) {
            const errText = await res.text();
            throw new Error(`Lá»—i server: ${errText}`);
          }

          const data = await res.json();

          if (data.token) {
            // âœ… LÆ°u Ä‘áº§y Ä‘á»§ thÃ´ng tin vÃ o localStorage
            localStorage.setItem("token", data.token);
            localStorage.setItem("userId", data.id); // ğŸ›  LÆ°u id ngÆ°á»i dÃ¹ng
            localStorage.setItem("name", data.name);
            localStorage.setItem("role", data.role);

            // âœ… Chuyá»ƒn hÆ°á»›ng theo role
            if (data.role === "admin") {
              window.location.href = "admin-home.html";
            } else if (data.role === "student") {
              window.location.href = "student-home.html";
            } else {
              alert("Vai trÃ² khÃ´ng há»£p lá»‡!");
            }
          } else {
            alert(data.error || "ÄÄƒng nháº­p tháº¥t báº¡i!");
          }
        } catch (err) {
          console.error("Login error:", err);
          alert("Lá»—i Ä‘Äƒng nháº­p hoáº·c khÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c vá»›i server.");
        }
      }
    </script>
  </body>
</html>
